<html>
	<head>
		<link rel="stylesheet" href="touch/resources/css/sencha-touch.css" type="text/css">
		<script src="touch/sencha-touch-all.js"></script>
		<script>
		var localStorageProxy = {
			type : "localstorage",
			id : "name"
		};
		var ajaxProxy = {
			type : "ajax",
			url : "Cities",
			reader : {
				type : "json",
				rootProperty : "cities"
			}
		};
		
		Ext.define("CityStore",{
			extend : "Ext.data.Store",
			config : {
				fields : ["name"],
				proxy : localStorageProxy,
				listeners : {
					write : function(){
						console.log("Successfully Synced to LocalStorage");
					},
					load : function(storeObj){
						var count = storeObj.getCount();
						if(count == 0){
							storeObj.setProxy(ajaxProxy);
							storeObj.load();
						}
						else{
							storeObj.setProxy(localStorageProxy);
							storeObj.sync();
						}
					}
				}
			}
		});
		var cityStore = Ext.create("CityStore");
		cityStore.load();	
		</script>
	</head>
	<body>
	</body>		
</html>