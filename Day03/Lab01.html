<html>
	<head>
		<link rel="stylesheet" href="touch/resources/css/sencha-touch.css" type="text/css">
		<script src="touch/sencha-touch-all.js"></script>
		<script>
		var localStorageProxy = {
			type : "localstorage",
			id : "name"
		};
		var ajaxProxy = {
			type : "ajax",
			url : "Cities",
			reader : {
				type : "json",
				rootProperty : "cities"
			}
		};
		Ext.define("CityStore",{
			extend : "Ext.data.Store",
			config : {
				fields : ["name"],
				proxy : localStorageProxy,
				listeners : {
					write : function(){
						console.log("Successfully Synced to LocalStorage");
					},
					load : function(storeObj){
						var count = storeObj.getCount();
						if(count == 0 && storeObj.getProxy()
											.getInitialConfig("type") != "ajax"){
							storeObj.setProxy(ajaxProxy);
							storeObj.load();
						}
						else{
							storeObj.setProxy(localStorageProxy);
							storeObj.sync();
						}
					}
				}
			}
		});
		
		Ext.define("CitiesPanel",{
			extend : "Ext.Panel",
			alias : "widget.citiespanel",
			config : {
				items : [
					{ 
						xtype : "titlebar", 
						title:"Cities",
						height : "5%"
					}
				]
			}
		});
		Ext.define("CityWeatherPanel",{
			extend : "Ext.Panel",
			alias : "widget.cityweatherpanel",
			config : {
				items : [{ 
					xtype : "titlebar", 
					title:"",
					height : "5%",
					items : [
						{
							iconCls : "arrow_left",
							listeners : {
								tap : function(){
									Ext.Viewport.setActiveItem(0);
								}
							}
						}
					]
				}]
			}
		});
		
		var cityStore = Ext.create("CityStore");
		cityStore.load();
		Ext.application({
			launch : function(){
				Ext.Viewport.add({
					xtype : "citiespanel"
				});
				Ext.Viewport.add({
					xtype : "cityweatherpanel"
				});
				
				//Viewport is a Panel with card layout and fullscreen set to true
				//It's automatically created during launch
				// Ext.Viewport.add(Ext.create("CitiesPanel"));
// 				Ext.Viewport.add(Ext.create("CityWeatherPanel"));
			}
		});		
		</script>
	</head>
	<body>
	</body>		
</html>